@startuml c4-containers
!define C4P https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master
!includeurl C4P/C4_Container.puml

Person(user, "Comerciante", "Usuário do sistema")
System_Boundary(sys, "Cash Flow System") {
  Container(gateway, "API Gateway", "Envoy/Ocelot", "Roteia tráfego, TLS termination, rate limiting")
  Container(transactionApi, "Transaction Service (API)", "ASP.NET Core 7+", "Exposes REST endpoints; writes to PostgreSQL; outbox writer")
  Container(consolidationApi, "Consolidation Service", "ASP.NET Core 7+", "Consumes events; maintains daily balances read model")
  Container(postgresTx, "Postgres - Transactions", "PostgreSQL", "Transaction DB (schema or dedicated instance)")
  Container(postgresRead, "Postgres - Read Model", "PostgreSQL", "Daily balance read model")
  Container(broker, "Message Broker", "Kafka or RabbitMQ", "Durable events; partitioned")
  Container(cache, "Redis (optional)", "Redis", "Cache for daily balances")
  Container(devUI, "Front-end (optional)", "Static app", "UI for creating transactions and consulting balance")
}

Rel(user, gateway, "HTTPS", "UI or API clients")
Rel(gateway, transactionApi, "HTTP/JSON", "POST /api/v1/transactions")
Rel(gateway, consolidationApi, "HTTP/JSON", "GET /api/v1/consolidations/daily")
Rel(transactionApi, postgresTx, "SQL", "EF Core / Migrations")
Rel(consolidationApi, postgresRead, "SQL", "EF Core / Migrations")
Rel(transactionApi, broker, "Publish", "Outbox/Producer -> TransactionCreated")
Rel(consolidationApi, broker, "Subscribe", "Consumes events to update aggregates")
Rel(consolidationApi, cache, "Read/Write", "GET/SET for hot queries (optional)")

@enduml
