@startuml c4-components-cons
!define C4P https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master
!includeurl C4P/C4_Component.puml

Container(consolidationApi, "Consolidation Service", "ASP.NET Core", "")
Component(consumer, "Event Consumer", "Consumes TransactionCreated/Updated from broker")
Component(aggService, "Aggregation Service", "Aplica evento na daily balance read model")
Component(repoRead, "Read Repository (EF Core)", "Persists daily balances")
Component(apiController, "API Controller", "Serves GET /daily-balance")
Component(cache, "Cache Adapter (Redis)", "Optional: cache hot queries")
Component(recomputeWorker, "Recompute Job", "Admin job to recompute aggregates from event store")

Rel(consumer, aggService, "Delivers events")
Rel(aggService, repoRead, "Updates daily_balance rows")
Rel(apiController, repoRead, "Queries daily_balance")
Rel(apiController, cache, "Reads/Writes (optional)")
Rel(recomputeWorker, repoRead, "Rebuild aggregates")

@enduml
